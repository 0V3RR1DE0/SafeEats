<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download SafeEats - Food Restriction Scanner</title>
  <meta name="description" content="Download SafeEats APK for Android or IPA for iOS. Multiple architecture options available.">
  <link rel="stylesheet" href="../styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    .download-page {
      min-height: 100vh;
      background: var(--surface-color);
      padding: calc(64px + var(--spacing-3xl)) 0 var(--spacing-3xl);
    }
    
    .download-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-lg);
    }
    
    .download-header {
      text-align: center;
      margin-bottom: var(--spacing-3xl);
    }
    
    .download-title {
      font-size: var(--font-size-4xl);
      font-weight: 700;
      color: var(--on-surface);
      margin-bottom: var(--spacing-md);
    }
    
    .download-subtitle {
      color: var(--on-surface-variant);
      font-size: var(--font-size-lg);
      margin-bottom: var(--spacing-xl);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .platform-tabs {
      display: flex;
      justify-content: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-3xl);
    }
    
    .tab-btn {
      padding: var(--spacing-md) var(--spacing-xl);
      border: 2px solid var(--outline);
      background: transparent;
      color: var(--on-surface-variant);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-normal);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-weight: 500;
      font-family: var(--font-family);
    }
    
    .tab-btn.active {
      border-color: var(--primary-color);
      background: var(--primary-color);
      color: white;
      box-shadow: 0 2px 8px rgba(46, 125, 50, 0.25);
    }
    
    .tab-btn:hover:not(.active) {
      border-color: var(--primary-color);
      color: var(--primary-color);
      background: rgba(46, 125, 50, 0.08);
    }
    
    .platform-content {
      display: none;
    }
    
    .platform-content.active {
      display: block;
    }
    
    .download-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
    }
    
    .download-card {
      background: var(--background-color);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      border: 1px solid rgba(121, 116, 126, 0.12);
      transition: var(--transition-normal);
      box-shadow: 0 2px 16px var(--shadow);
    }
    
    .download-card:hover {
      border-color: var(--primary-color);
      transform: translateY(-4px);
      box-shadow: 0 8px 32px var(--shadow-elevated);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }
    
    .card-icon {
      width: 56px;
      height: 56px;
      background: rgba(46, 125, 50, 0.1);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
    }
    
    .card-title {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--on-surface);
      margin: 0;
    }
    
    .card-subtitle {
      color: var(--on-surface-variant);
      font-size: var(--font-size-sm);
      margin: 0;
    }
    
    .card-description {
      color: var(--on-surface-variant);
      margin-bottom: var(--spacing-lg);
      line-height: 1.6;
    }
    
    .download-btn {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-normal);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      text-decoration: none;
      font-family: var(--font-family);
      box-shadow: 0 2px 8px rgba(46, 125, 50, 0.25);
    }
    
    .download-btn:hover {
      background: #1B5E20;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(46, 125, 50, 0.35);
    }
    
    .download-btn:disabled {
      background: var(--outline);
      color: var(--on-surface-variant);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .status-message {
      text-align: center;
      padding: var(--spacing-md);
      margin: var(--spacing-xl) 0;
      border-radius: var(--radius-md);
      display: none;
    }
    
    .status-loading {
      background: rgba(46, 125, 50, 0.1);
      color: var(--primary-color);
      border: 1px solid rgba(46, 125, 50, 0.2);
    }
    
    .status-error {
      background: rgba(211, 47, 47, 0.1);
      color: #D32F2F;
      border: 1px solid rgba(211, 47, 47, 0.2);
    }
    
    .status-success {
      background: rgba(46, 125, 50, 0.1);
      color: var(--primary-color);
      border: 1px solid rgba(46, 125, 50, 0.2);
    }
    
    .installation-guide {
      background: var(--background-color);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-top: var(--spacing-3xl);
      box-shadow: 0 2px 16px var(--shadow);
    }
    
    .guide-title {
      font-size: var(--font-size-2xl);
      font-weight: 600;
      color: var(--on-surface);
      margin-bottom: var(--spacing-lg);
    }
    
    .guide-steps {
      display: grid;
      gap: var(--spacing-lg);
    }
    
    .guide-step {
      display: flex;
      gap: var(--spacing-md);
      align-items: flex-start;
    }
    
    .step-number {
      width: 40px;
      height: 40px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex-shrink: 0;
      font-size: var(--font-size-lg);
    }
    
    .step-content h4 {
      margin: 0 0 var(--spacing-sm) 0;
      color: var(--on-surface);
      font-size: var(--font-size-lg);
      font-weight: 600;
    }
    
    .step-content p {
      margin: 0;
      color: var(--on-surface-variant);
      line-height: 1.6;
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--on-surface-variant);
      text-decoration: none;
      margin-top: var(--spacing-xl);
      transition: var(--transition-fast);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md);
    }
    
    .back-link:hover {
      color: var(--primary-color);
      background: rgba(46, 125, 50, 0.08);
    }
    
    .app-preview {
      text-align: center;
      margin: var(--spacing-xl) 0;
    }
    
    .app-screenshot {
      max-width: 300px;
      width: 100%;
      height: auto;
      border-radius: var(--radius-xl);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(121, 116, 126, 0.12);
    }
    
    .preview-caption {
      margin-top: var(--spacing-md);
      color: var(--on-surface-variant);
      font-size: var(--font-size-sm);
      font-style: italic;
    }
    
    @media (max-width: 768px) {
      .download-page {
        padding: calc(64px + var(--spacing-xl)) 0 var(--spacing-xl);
      }
      
      .download-title {
        font-size: var(--font-size-3xl);
      }
      
      .platform-tabs {
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-sm);
      }
      
      .download-grid {
        grid-template-columns: 1fr;
      }
      
      .installation-guide {
        padding: var(--spacing-lg);
      }
      
      .download-container {
        padding: 0 var(--spacing-md);
      }
    }
    
    @media (max-width: 480px) {
      .download-title {
        font-size: var(--font-size-2xl);
      }
      
      .tab-btn {
        padding: var(--spacing-sm) var(--spacing-lg);
        font-size: var(--font-size-sm);
      }
      
      .card-header {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
      }
      
      .guide-step {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
      }
    }
  </style>
</head>
<body>
  <div class="download-page">
    <div class="download-container">
      <div class="download-header">
        <h1 class="download-title">Download SafeEats</h1>
        <p class="download-subtitle">Choose your platform and architecture for the best experience</p>
        
        <div class="platform-tabs">
          <button class="tab-btn active" data-platform="android">
            <span class="material-icons">android</span>
            Android
          </button>
          <button class="tab-btn" data-platform="ios">
            <span class="material-icons">apple</span>
            iOS
          </button>
        </div>
      </div>
      
      <div id="status" class="status-message"></div>
      
      <!-- Android Platform -->
      <div id="android-content" class="platform-content active">
        <div class="download-grid" id="android-downloads">
          <!-- Downloads will be populated by JavaScript -->
        </div>
        
        <div class="installation-guide">
          <h3 class="guide-title">Android Installation Guide</h3>
          <div class="guide-steps">
            <div class="guide-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h4>Enable Unknown Sources</h4>
                <p>Go to Settings → Security → Install unknown apps and enable installation from your browser or file manager.</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h4>Download APK</h4>
                <p>Choose the appropriate APK for your device. Universal APK works on all devices but may be larger.</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h4>Install & Launch</h4>
                <p>Open the downloaded APK file, tap Install, and launch SafeEats to start scanning products safely.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- iOS Platform -->
      <div id="ios-content" class="platform-content">
        <div class="download-grid" id="ios-downloads">
          <!-- Downloads will be populated by JavaScript -->
        </div>
        
        <div class="installation-guide">
          <h3 class="guide-title">iOS Installation Guide</h3>
          <div class="guide-steps">
            <div class="guide-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h4>Download IPA File</h4>
                <p>Download the SafeEats IPA file to your computer or directly to your iOS device.</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h4>Install with AltStore or Sideloadly</h4>
                <p>Use AltStore, Sideloadly, or similar tools to sideload the IPA file onto your iOS device. You'll need an Apple ID.</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h4>Trust Developer</h4>
                <p>Go to Settings → General → VPN & Device Management → Trust the developer certificate for SafeEats.</p>
              </div>
            </div>
            <div class="guide-step">
              <div class="step-number">4</div>
              <div class="step-content">
                <h4>Launch App</h4>
                <p>SafeEats should now appear on your home screen. Launch it to start scanning products safely!</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <a href="../index.html" class="back-link">
        <span class="material-icons">arrow_back</span>
        Back to SafeEats Website
      </a>
    </div>
  </div>

  <script>
    let releases = null;
    let totalDownloads = 0;
    
    // Device detection
    function detectPlatform() {
      const userAgent = navigator.userAgent.toLowerCase();
      if (/iphone|ipad|ipod/.test(userAgent)) return 'ios';
      if (/android/.test(userAgent)) return 'android';
      if (/windows/.test(userAgent)) return 'android'; // Show Android for Windows
      if (/linux/.test(userAgent)) return 'android'; // Show Android for Linux
      return 'android'; // Default to Android
    }
    
    // Initialize platform selection
    function initializePlatform() {
      const detectedPlatform = detectPlatform();
      const tabs = document.querySelectorAll('.tab-btn');
      const contents = document.querySelectorAll('.platform-content');
      
      // Set active platform
      tabs.forEach(tab => {
        tab.classList.toggle('active', tab.dataset.platform === detectedPlatform);
      });
      
      contents.forEach(content => {
        content.classList.toggle('active', content.id === `${detectedPlatform}-content`);
      });
    }
    
    // Platform tab switching
    function setupTabs() {
      const tabs = document.querySelectorAll('.tab-btn');
      const contents = document.querySelectorAll('.platform-content');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const platform = tab.dataset.platform;
          
          tabs.forEach(t => t.classList.remove('active'));
          contents.forEach(c => c.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(`${platform}-content`).classList.add('active');
        });
      });
    }
    
    // Show status message
    function showStatus(message, type = 'loading') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status-message status-${type}`;
      status.style.display = 'block';
    }
    
    // Hide status message
    function hideStatus() {
      document.getElementById('status').style.display = 'none';
    }
    
    // Create download card
    function createDownloadCard(asset, type, description, icon = 'android') {
      const sizeInMB = (asset.size / (1024 * 1024)).toFixed(1);
      
      return `
        <div class="download-card">
          <div class="card-header">
            <div class="card-icon">
              <span class="material-icons">${icon}</span>
            </div>
            <div>
              <h3 class="card-title">${type}</h3>
              <p class="card-subtitle">${sizeInMB} MB</p>
            </div>
          </div>
          <p class="card-description">${description}</p>
          <a href="${asset.browser_download_url}" class="download-btn" onclick="trackDownload('${asset.name}')">
            <span class="material-icons">download</span>
            Download
          </a>
        </div>
      `;
    }
    
    // Populate downloads
    function populateDownloads() {
      if (!releases || !releases.assets) return;
      
      const androidContainer = document.getElementById('android-downloads');
      const iosContainer = document.getElementById('ios-downloads');
      
      let androidCards = '';
      let iosCards = '';
      
      releases.assets.forEach(asset => {
        if (asset.name.includes('.apk')) {
          let type, description;
          
          if (asset.name.includes('universal')) {
            type = 'Universal APK';
            description = 'Works on all Android devices. Larger file size but maximum compatibility.';
          } else if (asset.name.includes('arm64-v8a')) {
            type = 'ARM64 APK';
            description = 'Optimized for modern 64-bit ARM devices. Recommended for most phones.';
          } else if (asset.name.includes('armeabi-v7a')) {
            type = 'ARMv7 APK';
            description = 'For older 32-bit ARM devices. Use if ARM64 version doesn\'t work.';
          } else if (asset.name.includes('x86_64')) {
            type = 'x86_64 APK';
            description = 'For Intel/AMD 64-bit devices, emulators, and some tablets.';
          } else {
            type = 'Android APK';
            description = 'SafeEats for Android devices.';
          }
          
          androidCards += createDownloadCard(asset, type, description, 'android');
        } else if (asset.name.includes('.ipa')) {
          iosCards += createDownloadCard(asset, 'iOS IPA', 'SafeEats for iOS devices. Requires sideloading.', 'apple');
        }
      });
      
      if (androidCards) {
        androidContainer.innerHTML = androidCards;
      } else {
        androidContainer.innerHTML = '<p style="text-align: center; color: var(--on-surface-variant);">No Android releases found.</p>';
      }
      
      if (iosCards) {
        iosContainer.innerHTML = iosCards;
      } else {
        iosContainer.innerHTML = '<p style="text-align: center; color: var(--on-surface-variant);">No iOS releases found.</p>';
      }
    }
    
    // Fetch releases
    async function fetchReleases() {
      try {
        showStatus('Fetching latest releases...');
        
        const response = await fetch('https://api.github.com/repos/0V3RR1DE0/SafeEats/releases/latest');
        if (!response.ok) throw new Error('Failed to fetch releases');
        
        releases = await response.json();
        
        // Calculate total downloads
        totalDownloads = releases.assets.reduce((sum, asset) => sum + asset.download_count, 0);
        
        populateDownloads();
        hideStatus();
        
        // Update page title with download count
        if (totalDownloads > 0) {
          document.title = `Download SafeEats (${totalDownloads} downloads)`;
        }
        
      } catch (error) {
        console.error('Error fetching releases:', error);
        showStatus('Error loading releases. Please try again later or visit our GitHub page.', 'error');
        
        // Show fallback GitHub link
        document.getElementById('android-downloads').innerHTML = `
          <div class="download-card">
            <div class="card-header">
              <div class="card-icon">
                <span class="material-icons">open_in_new</span>
              </div>
              <div>
                <h3 class="card-title">GitHub Releases</h3>
                <p class="card-subtitle">Manual Download</p>
              </div>
            </div>
            <p class="card-description">Visit our GitHub releases page to download the latest version manually.</p>
            <a href="https://github.com/0V3RR1DE0/SafeEats/releases/latest" class="download-btn">
              <span class="material-icons">open_in_new</span>
              Open GitHub
            </a>
          </div>
        `;
      }
    }
    
    // Track downloads
    function trackDownload(filename) {
      // Track with Google Analytics if available
      if (typeof gtag !== 'undefined') {
        gtag('event', 'download', {
          'event_category': 'engagement',
          'event_label': filename,
          'value': 1
        });
      }
      
      console.log(`Download tracked: ${filename}`);
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      initializePlatform();
      setupTabs();
      fetchReleases();
    });
  </script>
</body>
</html>
